<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<script type="text/javascript" src="js/jquery-1.11.1.js"></script>
		<script type='text/javascript' src='js/strophe-custom-2.0.0.js'></script>
		<script type='text/javascript' src='js/json2.js'></script>
		<script type="text/javascript" src="js/easemob.im-1.0.5.js"></script>
		<script type="text/javascript" src="js/bootstrap.js"></script>	
		<link rel="stylesheet" type="text/css" href="css/webim.css" />
        <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
		<title></title>
	</head>
	<body>
		<div id="regist-box">
			user<input type="text" id="usename" />
			password<input type="password" id="password" />
			nickname<input type="text" id="nickname" />
			<input type="button" value="regist"  id="regist" />
        </div>
        
        <div id="login-box">
        	user <input type="text" name="uname" id="uname" value="" />
        	password <input type="text" name="password" id="password" value="" />
        	<input type="button" name="login" id="login" value="login" />
        </div>
        
        <div id="content">
        	消息内容 <textarea name="textarea" id="textarea" rows="" cols=""></textarea>
        	senTo <input type="text" name="sendto" id="sendto" value="" />
        	<button id="send">发送</button>
        </div>
	</body>
	<script type="text/javascript">
	    $(function(){
	    		//注册
				$('#regist').on('click',function(){
					var options = {
						username:$('#usename').val(),
						password:$('#password').val(),
						appKey:'easemob-demo#chatdemoui',
						success:function(result){
							//alert(result.action);
							alert('成功');
						},
						error:function(e){
							//alert(e.error);
							alert(e.error);
						}
					};
					Easemob.im.Helper.registerUser(options);
				});
	    	
	    	
	    		 var conn = null;
	    		 conn = new Easemob.im.Connection();
	    		 $('#login').on('click',function(){
	    		 	  var uname = $('#uname').val();
	    		 	  var pass = $('#password').val();
	    		 	  conn.open({
	    		 	  	  user:uname,
	    		 	  	  pwd:pass,
	    		 	  	  appKey : 'easemob-demo#chatdemoui'
	    		 	  });
	    		 });
	    		 conn.init({
	    		 	onOpened:function(){
//	    		 		 alert('登录成功');
//	    		 		 conn.setPresence();
                         conn.getRoster({
                         	success:function(roster){
                         		for(var i in roster){
                         			 var ros = roster[i];       //好友对象
                         			 //ros.name为好友名称
                         		}
                         	}
                         });
	    		 	},
	    		 	onTextMessage : function(message){
//						console.log(message);
//						alert("发送消息成功");
                        var from = message.from;
                        var mestype = message.type;
                        var messageContent = message.data;
                        if(mestype == 'groupchat'){
                        	//群组处理
                        }else{
                        	//个人处理
                        }
			       }
	    		 });
	    		 $('#send').on('click',function(){
	    			sendText();
	    		 });
		    	var sendText = function(){
		    			var msg = $('#textarea').val();
		    			var to = $('#sendto').val();
		    			var options = {to:to,msg:msg,type:"chat"};
                        conn.sendTextMessage(options);
		    	};
	    });
	</script>
</html>
